#!/bin/bash -eux

case "$1" in
  -v|--version)
    version="$2"
esac

# Downloads and unzip GateIn Portal if it's not present in broker node
if [[ ! -d /tmp/gatein-portal ]] ; then
  wget -P /tmp http://downloads.jboss.org/gatein/Releases/Portal/3.6.0.Final/GateIn-3.6.0.Final-jbossas7.zip
  unzip /tmp/GateIn-3.6.0.Final-jbossas7.zip -d /tmp
  mv /tmp/GateIn-3.6.0.Final-jbossas7 /tmp/gatein-portal
fi

# Checks if gatein-portal is present in node
if [[ ! -d /tmp/gatein-portal ]] ; then
  echo "GateIn Portal not found, GateIn cartridge cannot continue"
  exit 1  
fi

# Installs gatein-portal on cartridge
mkdir -p ${OPENSHIFT_GATEIN_DIR}/gatein-portal
cp -R /tmp/gatein-portal/{appclient,bin,bundles,docs,domain,gatein,standalone,welcome-content} ${OPENSHIFT_GATEIN_DIR}/gatein-portal
ln -s /tmp/gatein-portal/modules ${OPENSHIFT_GATEIN_DIR}/gatein-portal
ln -s /tmp/gatein-portal/jboss-modules.jar ${OPENSHIFT_GATEIN_DIR}/gatein-portal

# Installs template
mkdir -p ${OPENSHIFT_GATEIN_DIR}/template/{deployments,extensions}